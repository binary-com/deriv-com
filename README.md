<h1 align="center">
  Deriv.com
</h1>

## In this document:

-   [pre-installation](#requirements)
-   [üöÄ Quick start](#quick-start)
-   [How to contribute](#how-to-contribute)
-   [Manage releases](#manage-releases)
-   [Test link deployment](#deployment)

## Other Documents

-   [General implementation](documents/implementation-guide.md) - Contain ways to do development in deriv.com
-   [Style guide](documents/style-guide.md) - Contain file structure and advice for developers

## Requirements

-   node
-   npm
-   git
-   gatsby-cli (npm install -g gatsby-cli)

## Editor helpers

-   Prettier setup in your editor https://prettier.io/ (or you can run `npm run format`)
-   Stylelint setup in your editor https://stylelint.io/ (or you can run `npm run stylelint`)
-   Eslint setup in your editor https://eslint.org/ (or you can run `npm run eslint`)

## Quick start

1.  **Install your dependencies:**

    ```sh
    npm ci
    ```

2.  **To start developing:**

    ```sh
    npm start
    ```

3.  **Open the source code and start editing!**

    Your site is now running at `http://localhost:8000`!

    _Note: You'll also see a second link: _`http://localhost:8000/___graphql`_. This is a tool you can use to experiment with querying your data. Learn more about using this tool in the [Gatsby tutorial](https://www.gatsbyjs.org/tutorial/part-five/#introducing-graphiql)._

## How to contribute

We have two types of PR (Pull request):

### base master

PR will be based on master if the commits are not having
text changes

Steps to create the PR:

```sh

git checkout master
git pull upstream master
git checkout -b [_your_branch_name]
-- make your changes --
git push -u origin [_your_branch_name]
-- Click on the autogenerated link from terminal to open the PR to master --
```

### base crowdin

-   Checkout crowdin branch, pull the latest changes (upstream crowdin), and create new branch from crowdin
    ```sh
    git checkout crowdin
    git pull upstream crowdin
    git checkout -b [_your_branch_name]
    ```
-   Pull the latest changes from dev branch
    ```sh
    git pull upstream dev
    ```
-   Extract translation text to update `messages.json`
    ```sh
    cd scripts/
    node extract-translations.js
    ```
-   Commit changes and make pull request to upstream `crowdin` branch
-   Merge pull request will trigger crowdin hook to update translation text in crowdin

## Manage releases

`git tag ${RELEASE_TARGET}_vYYYYMMDD_${INTEGER} -m 'some message'`

Based on `RELEASE_TARGET` there are 2 types of release:

1. Release to staging:

    1. `git tag staging_v20191205 -m 'release staging'` # the tag needs to follow the RegExp format `/^staging_*/`
    2. `git push origin staging_v20191205`

2. Release to production:
    1. `git tag production_v20191205 -m 'release production'` # the tag needs to follow the RegExp format `/^production_*/`
    2. `git push origin production_v20191205`

## üì¶ Deployment

//TODO
Test link deployment preview

1. **Basic name.github.io/deriv-com/**

    ```sh
    npm run deploy-dev
    ```

    ‚ö†Ô∏è This will remove your branch deployments

2. **To a specific branch:**

    ```sh
    branch_name=fix_all_the_bugs npm run deploy-branch
    ```

    - This will be deployed to name.github.io/deriv-com/br/fix_all_the_bugs
    - To cleanup all branches run `npm run deploy-dev`

## FAQ

// TODO
